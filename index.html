<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form + Live Results</title>
    <style>
      :root{
        /* FORM sizing */
        --form-initial-min: 640px;
        --form-initial-max: 1100px;
        --form-after-submit: 320px;

        /* CHART original published size from Google (must match your embed) */
        --chart-base-w: 600;  /* px */
        --chart-base-h: 377;  /* px */

        /* ✅ Cap how wide the chart is allowed to get */
        --chart-max-width: 960px;  /* try 900–1100px to taste */
      }

      html, body { margin:0; padding:0; background:#fff; font-family: Arial, sans-serif; }
      .container { width: 100%; margin: 0 auto; padding: 16px; box-sizing: border-box; }
      .block { margin-bottom: 24px; }

      iframe { width: 100%; border: 0; display: block; }

      /* Form sizing */
      #formFrame {
        height: clamp(var(--form-initial-min), 90vh, var(--form-initial-max));
        transition: height 240ms ease;
      }

      /* Chart wrappers:
         - .chart-outer: centers chart and caps max width so it never grows too big
         - #chartContainer: reserves exact scaled height, hides overflow
         - #chartScaler: the fixed-size inner box we scale up/down smoothly
      */
      .chart-outer {
        width: 100%;
        max-width: var(--chart-max-width);
        margin: 0 auto;          /* center within page */
      }
      #chartContainer {
        width: 100%;
        overflow: hidden;        /* no horizontal cut-off/scrollbars */
      }
      #chartScaler {
        width: calc(var(--chart-base-w) * 1px);
        height: calc(var(--chart-base-h) * 1px);
        transform-origin: 0 0;   /* scale from top-left */
      }

      @media (max-width: 480px) {
        .container { padding: 12px; }
      }

      .actions { margin: 0 0 12px 0; }
      .actions a {
        text-decoration: none;
        display: inline-block;
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div class="container">

      <div class="actions">
        <a href="#results">Skip to live results ↓</a>
      </div>

      <!-- Google Form -->
      <div class="block">
        <iframe
          id="formFrame"
          title="Quick pulse: actions taken (Form)"
          src="https://docs.google.com/forms/d/e/1FAIpQLSePnkxnhsjCdUVEYkUXFRT-IK0H5nDqQHjbOrNqdVxB67K9UQ/viewform?embedded=true">
        </iframe>
      </div>

      <!-- Google Chart (fluid up to a max width) -->
      <div class="block" id="results">
        <div class="chart-outer">
          <div id="chartContainer">
            <div id="chartScaler">
              <iframe
                id="chartFrame"
                title="Live results chart"
                width="600"
                height="377"
                scrolling="no"
                src="https://docs.google.com/spreadsheets/d/e/2PACX-1vS1-u7X5Qm212u-m4uNqtbM4djbjHepF5vJMp2jAh_Yst-7tfvAVGjSwHNkElHNQPKdE52sfXL2y2ZH/pubchart?oid=543343219&amp;format=interactive">
              </iframe>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Shrink the form after submission and jump to results
      (function () {
        var form = document.getElementById('formFrame');
        var loadCount = 0;
        if (!form) return;

        form.addEventListener('load', function () {
          loadCount += 1;
          if (loadCount > 1) {
            form.style.height = 'var(--form-after-submit)';
            // Refresh chart (cache-bust) so new vote shows
            setTimeout(function () {
              var chart = document.getElementById('chartFrame');
              if (chart) {
                var base = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1-u7X5Qm212u-m4uNqtbM4djbjHepF5vJMp2jAh_Yst-7tfvAVGjSwHNkElHNQPKdE52sfXL2y2ZH/pubchart?oid=543343219&format=interactive";
                chart.src = base + "&v=" + Date.now();
              }
            }, 600);

            var results = document.getElementById('results');
            if (results && results.scrollIntoView) {
              results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        }, { passive: true });
      })();

      // Scale the fixed-size chart to fit the available width, up to the max
      (function () {
        var outer = document.querySelector('.chart-outer');
        var container = document.getElementById('chartContainer');
        var scaler = document.getElementById('chartScaler');
        if (!outer || !container || !scaler) return;

        var BASE_W = parseFloat(getComputedStyle(scaler).width);  // 600
        var BASE_H = parseFloat(getComputedStyle(scaler).height); // 377

        function resize() {
          var cw = outer.clientWidth;                 // limited by --chart-max-width
          var scale = cw / BASE_W;                    // exact scale to fill width
          scaler.style.transform = 'scale(' + scale + ')';
          container.style.height = (BASE_H * scale) + 'px'; // reserve correct height
        }

        window.addEventListener('load', resize);
        window.addEventListener('resize', function () { requestAnimationFrame(resize); });
        window.addEventListener('orientationchange', function () { setTimeout(resize, 150); });
      })();
    </script>
  </body>
</html>
