<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form + Live Results</title>
    <style>
      :root{
        /* FORM sizing */
        --form-initial-min: 640px;
        --form-initial-max: 1100px;
        --form-after-submit: 320px;

        /* CHART original published size from Google (keep these matched to your embed) */
        --chart-base-w: 600;  /* px */
        --chart-base-h: 377;  /* px */

        /* Max upscale factor to avoid blur on giant screens (raise if you want) */
        --chart-max-scale: 2.0;
      }

      html, body { margin:0; padding:0; background:#fff; font-family: Arial, sans-serif; }
      .container { width: 100%; margin: 0 auto; padding: 16px; box-sizing: border-box; }
      .block { margin-bottom: 24px; }

      iframe { width: 100%; border: 0; display: block; }

      /* Form sizing */
      #formFrame {
        height: clamp(var(--form-initial-min), 90vh, var(--form-initial-max));
        transition: height 240ms ease;
      }

      /* Chart scaler: keeps aspect and centers the chart while we scale it */
      #chartContainer {
        width: 100%;
        display: flex;
        justify-content: center;  /* center horizontally */
        align-items: flex-start;
        /* height is set via JS to base_h * scale so the page reserves the right space */
        overflow: hidden;
      }
      #chartScaler {
        width: calc(var(--chart-base-w) * 1px);
        height: calc(var(--chart-base-h) * 1px);
        transform-origin: 0 0; /* scale from top-left */
      }

      @media (max-width: 480px) {
        .container { padding: 12px; }
      }

      .actions { margin: 0 0 12px 0; }
      .actions a {
        text-decoration: none;
        display: inline-block;
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div class="container">

      <div class="actions">
        <a href="#results">Skip to live results â†“</a>
      </div>

      <!-- Google Form -->
      <div class="block">
        <iframe
          id="formFrame"
          title="Quick pulse: actions taken (Form)"
          src="https://docs.google.com/forms/d/e/1FAIpQLSePnkxnhsjCdUVEYkUXFRT-IK0H5nDqQHjbOrNqdVxB67K9UQ/viewform?embedded=true">
        </iframe>
      </div>

      <!-- Google Chart (scaled responsively) -->
      <div class="block" id="results">
        <div id="chartContainer">
          <div id="chartScaler">
            <iframe
              id="chartFrame"
              title="Live results chart"
              width="600"
              height="377"
              scrolling="no"
              src="https://docs.google.com/spreadsheets/d/e/2PACX-1vS1-u7X5Qm212u-m4uNqtbM4djbjHepF5vJMp2jAh_Yst-7tfvAVGjSwHNkElHNQPKdE52sfXL2y2ZH/pubchart?oid=543343219&amp;format=interactive">
            </iframe>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Shrink form after submission and jump to results
      (function () {
        var form = document.getElementById('formFrame');
        var loadCount = 0;
        if (!form) return;

        form.addEventListener('load', function () {
          loadCount += 1;
          if (loadCount > 1) {
            form.style.height = 'var(--form-after-submit)';
            // Force-refresh chart (cache-bust) a moment after submit so new vote shows
            setTimeout(function () {
              var chart = document.getElementById('chartFrame');
              if (chart) chart.src = chart.src.split('#')[0].split('?')[0] + '?v=' + Date.now() +
                '&' + 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS1-u7X5Qm212u-m4uNqtbM4djbjHepF5vJMp2jAh_Yst-7tfvAVGjSwHNkElHNQPKdE52sfXL2y2ZH/pubchart?oid=543343219&format=interactive'.split('?')[1];
            }, 600);

            var results = document.getElementById('results');
            if (results && results.scrollIntoView) {
              results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        }, { passive: true });
      })();

      // Scale the fixed-size Google chart to fill the container width responsively
      (function () {
        var container = document.getElementById('chartContainer');
        var scaler = document.getElementById('chartScaler');
        if (!container || !scaler) return;

        var BASE_W = parseFloat(getComputedStyle(scaler).width);  // 600
        var BASE_H = parseFloat(getComputedStyle(scaler).height); // 377
        var MAX_SCALE = parseFloat(getComputedStyle(document.documentElement)
                          .getPropertyValue('--chart-max-scale')) || 2.0;

        function resize() {
          var cw = container.clientWidth;
          var scale = cw / BASE_W;
          if (scale > MAX_SCALE) scale = MAX_SCALE; // cap super-wide upscaling to reduce blurriness
          if (scale < 0.2) scale = 0.2;             // avoid absurdly tiny charts
          scaler.style.transform = 'scale(' + scale + ')';
          container.style.height = (BASE_H * scale) + 'px';
        }

        window.addEventListener('load', resize);
        window.addEventListener('resize', function () { requestAnimationFrame(resize); });
        window.addEventListener('orientationchange', function () { setTimeout(resize, 150); });
      })();
    </script>
  </body>
</html>
